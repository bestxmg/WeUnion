{"ast":null,"code":"import React,{useEffect,useMemo,useState}from'react';import{Dialog,DialogTitle,DialogContent,DialogActions,List,ListItem,ListItemAvatar,ListItemText,Avatar,TextField,InputAdornment,Button,CircularProgress,Alert,Box}from'@mui/material';import{Search}from'@mui/icons-material';import api from'../../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const StartChatDialog=_ref=>{let{open,onClose,onStarted}=_ref;const[contacts,setContacts]=useState([]);const[loading,setLoading]=useState(false);const[creating,setCreating]=useState(false);const[error,setError]=useState('');const[query,setQuery]=useState('');useEffect(()=>{if(!open)return;let cancelled=false;const load=async()=>{try{setLoading(true);setError('');const res=await api.get('/contacts');if(!cancelled)setContacts(res.data.filter(c=>c.contact_status==='accepted'));}catch(e){if(!cancelled)setError('Failed to load contacts');}finally{if(!cancelled)setLoading(false);}};load();return()=>{cancelled=true;};},[open]);const filtered=useMemo(()=>{if(!query)return contacts;const q=query.toLowerCase();return contacts.filter(c=>{var _c$display_name,_c$username;return((_c$display_name=c.display_name)===null||_c$display_name===void 0?void 0:_c$display_name.toLowerCase().includes(q))||((_c$username=c.username)===null||_c$username===void 0?void 0:_c$username.toLowerCase().includes(q));});},[contacts,query]);const startChat=async contactId=>{try{setCreating(true);setError('');const res=await api.post('/messages/conversations/individual',{contactId});const conversationId=res.data.conversationId;if(onStarted&&conversationId)onStarted(conversationId);if(onClose)onClose();}catch(e){var _e$response,_e$response$data;setError(((_e$response=e.response)===null||_e$response===void 0?void 0:(_e$response$data=_e$response.data)===null||_e$response$data===void 0?void 0:_e$response$data.error)||'Failed to start chat');}finally{setCreating(false);}};return/*#__PURE__*/_jsxs(Dialog,{open:open,onClose:onClose,fullWidth:true,maxWidth:\"sm\",children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Start a chat\"}),/*#__PURE__*/_jsxs(DialogContent,{dividers:true,children:[/*#__PURE__*/_jsx(TextField,{value:query,onChange:e=>setQuery(e.target.value),placeholder:\"Search contacts\",fullWidth:true,size:\"small\",margin:\"dense\",InputProps:{startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:/*#__PURE__*/_jsx(Search,{})})}}),error&&/*#__PURE__*/_jsx(Box,{mt:1,children:/*#__PURE__*/_jsx(Alert,{severity:\"error\",children:error})}),loading?/*#__PURE__*/_jsx(Box,{display:\"flex\",justifyContent:\"center\",py:4,children:/*#__PURE__*/_jsx(CircularProgress,{})}):/*#__PURE__*/_jsxs(List,{sx:{maxHeight:360,overflow:'auto'},children:[filtered.map(c=>{var _c$display_name2,_c$username2;return/*#__PURE__*/_jsxs(ListItem,{button:true,disabled:creating,onClick:()=>startChat(c.user_id),children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{src:c.avatar_url,children:((_c$display_name2=c.display_name)===null||_c$display_name2===void 0?void 0:_c$display_name2[0])||((_c$username2=c.username)===null||_c$username2===void 0?void 0:_c$username2[0])||'?'})}),/*#__PURE__*/_jsx(ListItemText,{primary:c.display_name||c.username,secondary:c.status})]},c.user_id);}),!loading&&filtered.length===0&&/*#__PURE__*/_jsx(Box,{textAlign:\"center\",color:\"text.secondary\",py:4,children:\"No contacts found\"})]})]}),/*#__PURE__*/_jsx(DialogActions,{children:/*#__PURE__*/_jsx(Button,{onClick:onClose,disabled:creating,children:\"Close\"})})]});};export default StartChatDialog;","map":{"version":3,"names":["React","useEffect","useMemo","useState","Dialog","DialogTitle","DialogContent","DialogActions","List","ListItem","ListItemAvatar","ListItemText","Avatar","TextField","InputAdornment","Button","CircularProgress","Alert","Box","Search","api","jsx","_jsx","jsxs","_jsxs","StartChatDialog","_ref","open","onClose","onStarted","contacts","setContacts","loading","setLoading","creating","setCreating","error","setError","query","setQuery","cancelled","load","res","get","data","filter","c","contact_status","e","filtered","q","toLowerCase","_c$display_name","_c$username","display_name","includes","username","startChat","contactId","post","conversationId","_e$response","_e$response$data","response","fullWidth","maxWidth","children","dividers","value","onChange","target","placeholder","size","margin","InputProps","startAdornment","position","mt","severity","display","justifyContent","py","sx","maxHeight","overflow","map","_c$display_name2","_c$username2","button","disabled","onClick","user_id","src","avatar_url","primary","secondary","status","length","textAlign","color"],"sources":["/workspace/client/src/components/Chat/StartChatDialog.js"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemText,\n  Avatar,\n  TextField,\n  InputAdornment,\n  Button,\n  CircularProgress,\n  Alert,\n  Box,\n} from '@mui/material';\nimport { Search } from '@mui/icons-material';\nimport api from '../../services/api';\n\nconst StartChatDialog = ({ open, onClose, onStarted }) => {\n  const [contacts, setContacts] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [creating, setCreating] = useState(false);\n  const [error, setError] = useState('');\n  const [query, setQuery] = useState('');\n\n  useEffect(() => {\n    if (!open) return;\n    let cancelled = false;\n    const load = async () => {\n      try {\n        setLoading(true);\n        setError('');\n        const res = await api.get('/contacts');\n        if (!cancelled) setContacts(res.data.filter(c => c.contact_status === 'accepted'));\n      } catch (e) {\n        if (!cancelled) setError('Failed to load contacts');\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    };\n    load();\n    return () => { cancelled = true; };\n  }, [open]);\n\n  const filtered = useMemo(() => {\n    if (!query) return contacts;\n    const q = query.toLowerCase();\n    return contacts.filter(c =>\n      c.display_name?.toLowerCase().includes(q) ||\n      c.username?.toLowerCase().includes(q)\n    );\n  }, [contacts, query]);\n\n  const startChat = async (contactId) => {\n    try {\n      setCreating(true);\n      setError('');\n      const res = await api.post('/messages/conversations/individual', { contactId });\n      const conversationId = res.data.conversationId;\n      if (onStarted && conversationId) onStarted(conversationId);\n      if (onClose) onClose();\n    } catch (e) {\n      setError(e.response?.data?.error || 'Failed to start chat');\n    } finally {\n      setCreating(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onClose={onClose} fullWidth maxWidth=\"sm\">\n      <DialogTitle>Start a chat</DialogTitle>\n      <DialogContent dividers>\n        <TextField\n          value={query}\n          onChange={(e) => setQuery(e.target.value)}\n          placeholder=\"Search contacts\"\n          fullWidth\n          size=\"small\"\n          margin=\"dense\"\n          InputProps={{\n            startAdornment: (\n              <InputAdornment position=\"start\">\n                <Search />\n              </InputAdornment>\n            )\n          }}\n        />\n\n        {error && (\n          <Box mt={1}>\n            <Alert severity=\"error\">{error}</Alert>\n          </Box>\n        )}\n\n        {loading ? (\n          <Box display=\"flex\" justifyContent=\"center\" py={4}>\n            <CircularProgress />\n          </Box>\n        ) : (\n          <List sx={{ maxHeight: 360, overflow: 'auto' }}>\n            {filtered.map((c) => (\n              <ListItem\n                key={c.user_id}\n                button\n                disabled={creating}\n                onClick={() => startChat(c.user_id)}\n              >\n                <ListItemAvatar>\n                  <Avatar src={c.avatar_url}>\n                    {c.display_name?.[0] || c.username?.[0] || '?'}\n                  </Avatar>\n                </ListItemAvatar>\n                <ListItemText\n                  primary={c.display_name || c.username}\n                  secondary={c.status}\n                />\n              </ListItem>\n            ))}\n            {!loading && filtered.length === 0 && (\n              <Box textAlign=\"center\" color=\"text.secondary\" py={4}>\n                No contacts found\n              </Box>\n            )}\n          </List>\n        )}\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onClose} disabled={creating}>Close</Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default StartChatDialog;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}