{"ast":null,"code":"import _objectSpread from\"/workspace/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useReducer,useRef,useEffect}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();const authReducer=(state,action)=>{switch(action.type){case'LOGIN_START':return _objectSpread(_objectSpread({},state),{},{isLoading:true,error:null});case'LOGIN_SUCCESS':return _objectSpread(_objectSpread({},state),{},{isLoading:false,user:action.payload.user,token:action.payload.token,error:null,isAuthenticated:true});case'LOGIN_FAILURE':return _objectSpread(_objectSpread({},state),{},{isLoading:false,error:action.payload,isAuthenticated:false});case'LOGOUT':return _objectSpread(_objectSpread({},state),{},{user:null,token:null,error:null,isAuthenticated:false});case'UPDATE_USER':return _objectSpread(_objectSpread({},state),{},{user:_objectSpread(_objectSpread({},state.user),action.payload)});case'CLEAR_ERROR':return _objectSpread(_objectSpread({},state),{},{error:null});case'SET_INITIALIZED':return _objectSpread(_objectSpread({},state),{},{isInitialized:true});default:return state;}};const initialState={user:null,token:localStorage.getItem('token'),isLoading:false,error:null,isAuthenticated:false,isInitialized:false};export const AuthProvider=_ref=>{let{children}=_ref;const[state,dispatch]=useReducer(authReducer,initialState);const initializingRef=useRef(false);const login=(user,token)=>{localStorage.setItem('token',token);dispatch({type:'LOGIN_SUCCESS',payload:{user,token}});};const logout=()=>{localStorage.removeItem('token');dispatch({type:'LOGOUT'});};const updateUser=userData=>{dispatch({type:'UPDATE_USER',payload:userData});};const setLoading=isLoading=>{if(isLoading){dispatch({type:'LOGIN_START'});}};const setError=error=>{dispatch({type:'LOGIN_FAILURE',payload:error});};const clearError=()=>{dispatch({type:'CLEAR_ERROR'});};const setInitialized=()=>{dispatch({type:'SET_INITIALIZED'});};// Listen for localStorage changes (token removal from API interceptor)\nuseEffect(()=>{const handleStorageChange=e=>{if(e.key==='token'&&e.newValue===null&&state.isAuthenticated){// Token was removed, logout user\ndispatch({type:'LOGOUT'});}};window.addEventListener('storage',handleStorageChange);return()=>window.removeEventListener('storage',handleStorageChange);},[state.isAuthenticated]);const value={user:state.user,token:state.token,isLoading:state.isLoading,error:state.error,isAuthenticated:state.isAuthenticated,isInitialized:state.isInitialized,initializingRef,login,logout,updateUser,setLoading,setError,clearError,setInitialized};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};","map":{"version":3,"names":["React","createContext","useContext","useReducer","useRef","useEffect","jsx","_jsx","AuthContext","authReducer","state","action","type","_objectSpread","isLoading","error","user","payload","token","isAuthenticated","isInitialized","initialState","localStorage","getItem","AuthProvider","_ref","children","dispatch","initializingRef","login","setItem","logout","removeItem","updateUser","userData","setLoading","setError","clearError","setInitialized","handleStorageChange","e","key","newValue","window","addEventListener","removeEventListener","value","Provider","useAuth","context","Error"],"sources":["/workspace/client/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useReducer, useRef, useEffect } from 'react';\n\nconst AuthContext = createContext();\n\nconst authReducer = (state, action) => {\n  switch (action.type) {\n    case 'LOGIN_START':\n      return { ...state, isLoading: true, error: null };\n    case 'LOGIN_SUCCESS':\n      return { \n        ...state, \n        isLoading: false, \n        user: action.payload.user, \n        token: action.payload.token, \n        error: null,\n        isAuthenticated: true\n      };\n    case 'LOGIN_FAILURE':\n      return { ...state, isLoading: false, error: action.payload, isAuthenticated: false };\n    case 'LOGOUT':\n      return { ...state, user: null, token: null, error: null, isAuthenticated: false };\n    case 'UPDATE_USER':\n      return { ...state, user: { ...state.user, ...action.payload } };\n    case 'CLEAR_ERROR':\n      return { ...state, error: null };\n    case 'SET_INITIALIZED':\n      return { ...state, isInitialized: true };\n    default:\n      return state;\n  }\n};\n\nconst initialState = {\n  user: null,\n  token: localStorage.getItem('token'),\n  isLoading: false,\n  error: null,\n  isAuthenticated: false,\n  isInitialized: false,\n};\n\nexport const AuthProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(authReducer, initialState);\n  const initializingRef = useRef(false);\n\n  const login = (user, token) => {\n    localStorage.setItem('token', token);\n    dispatch({ type: 'LOGIN_SUCCESS', payload: { user, token } });\n  };\n\n  const logout = () => {\n    localStorage.removeItem('token');\n    dispatch({ type: 'LOGOUT' });\n  };\n\n  const updateUser = (userData) => {\n    dispatch({ type: 'UPDATE_USER', payload: userData });\n  };\n\n  const setLoading = (isLoading) => {\n    if (isLoading) {\n      dispatch({ type: 'LOGIN_START' });\n    }\n  };\n\n  const setError = (error) => {\n    dispatch({ type: 'LOGIN_FAILURE', payload: error });\n  };\n\n  const clearError = () => {\n    dispatch({ type: 'CLEAR_ERROR' });\n  };\n\n  const setInitialized = () => {\n    dispatch({ type: 'SET_INITIALIZED' });\n  };\n\n  // Listen for localStorage changes (token removal from API interceptor)\n  useEffect(() => {\n    const handleStorageChange = (e) => {\n      if (e.key === 'token' && e.newValue === null && state.isAuthenticated) {\n        // Token was removed, logout user\n        dispatch({ type: 'LOGOUT' });\n      }\n    };\n\n    window.addEventListener('storage', handleStorageChange);\n    return () => window.removeEventListener('storage', handleStorageChange);\n  }, [state.isAuthenticated]);\n\n  const value = {\n    user: state.user,\n    token: state.token,\n    isLoading: state.isLoading,\n    error: state.error,\n    isAuthenticated: state.isAuthenticated,\n    isInitialized: state.isInitialized,\n    initializingRef,\n    login,\n    logout,\n    updateUser,\n    setLoading,\n    setError,\n    clearError,\n    setInitialized,\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}